<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.repository.UserMapper">

    <select id="getUser" resultType="com.project.model.UserDto">
        SELECT
            m.USER_ID,
            m.PASSWD,
            m.USER_NAME,
            m.EMAIL,
            m.TEL,
            m.AGE,
            m.SIGNUP_DATE,
            m.TOKEN,
            m.TOKEN_VALIDITY,
            m.VIEW_ADULT,
            m.SAVE_HISTORY,
            m.TERMS,
            m.USER_TPCD,
            c1.COMMON_NAME as USER_TPCD_NAME,
            m.LANG_TPCD,
            c2.COMMON_NAME as LANG_TPCD_NAME,
            m.DATE_TPCD,
            c3.COMMON_NAME as DATE_TPCD_NAME
        FROM MEMBERS m
        LEFT JOIN COMMON_CODE c1
            ON m.USER_TPCD = c1.COMMON_VALUE AND c1.COMMON_CODE = 'USER_TPCD'
        LEFT JOIN COMMON_CODE c2
            ON m.LANG_TPCD = c2.COMMON_VALUE AND c2.COMMON_CODE = 'LANG_TPCD'
        LEFT JOIN COMMON_CODE c3
            ON m.DATE_TPCD = c3.COMMON_VALUE AND c3.COMMON_CODE = 'DATE_TPCD';
        <where>
            <if test="userId != null">
                WHERE m.USER_ID = #{userId}
            </if>
            <if test="passwd != null">
                AND m.PASSWD = #{passwd}
            </if>
        </where>
    </select>

    <select id="getUserList" resultType="com.project.model.UserDto">
        SELECT
            m.USER_ID,
            m.PASSWD,
            m.USER_NAME,
            m.EMAIL,
            m.TEL,
            m.AGE,
            m.SIGNUP_DATE,
            m.TOKEN,
            m.TOKEN_VALIDITY,
            m.VIEW_ADULT,
            m.SAVE_HISTORY,
            m.TERMS,
            m.USER_TPCD,
            c1.COMMON_NAME as USER_TPCD_NAME,
            m.LANG_TPCD,
            c2.COMMON_NAME as LANG_TPCD_NAME,
            m.DATE_TPCD,
            c3.COMMON_NAME as DATE_TPCD_NAME
        FROM MEMBERS m
        LEFT JOIN COMMON_CODE c1
            ON m.USER_TPCD = c1.COMMON_VALUE AND c1.COMMON_CODE = 'USER_TPCD'
        LEFT JOIN COMMON_CODE c2
            ON m.LANG_TPCD = c2.COMMON_VALUE AND c2.COMMON_CODE = 'LANG_TPCD'
        LEFT JOIN COMMON_CODE c3
            ON m.DATE_TPCD = c3.COMMON_VALUE AND c3.COMMON_CODE = 'DATE_TPCD'
    </select>

    <select id="getUserDetail" resultType="com.project.model.UserDto">
        SELECT
            m.USER_ID,
            m.PASSWD,
            m.USER_NAME,
            m.EMAIL,
            m.TEL,
            m.AGE,
            m.SIGNUP_DATE,
            m.TOKEN,
            m.TOKEN_VALIDITY,
            m.VIEW_ADULT,
            m.SAVE_HISTORY,
            m.TERMS,
            m.USER_TPCD,
            c1.COMMON_NAME as USER_TPCD_NAME,
            m.LANG_TPCD,
            c2.COMMON_NAME as LANG_TPCD_NAME,
            m.DATE_TPCD,
            c3.COMMON_NAME as DATE_TPCD_NAME
        FROM MEMBERS m
        LEFT JOIN COMMON_CODE c1
            ON m.USER_TPCD = c1.COMMON_VALUE AND c1.COMMON_CODE = 'USER_TPCD'
        LEFT JOIN COMMON_CODE c2
            ON m.LANG_TPCD = c2.COMMON_VALUE AND c2.COMMON_CODE = 'LANG_TPCD'
        LEFT JOIN COMMON_CODE c3
            ON m.DATE_TPCD = c3.COMMON_VALUE AND c3.COMMON_CODE = 'DATE_TPCD'
        WHERE m.USER_ID = #{userId}
    </select>
    <select id="checkId" resultType="int">
        SELECT COUNT(*) FROM MEMBERS WHERE USER_ID=#{id}
    </select>
    <select id="checkEmail" resultType="int">
        SELECT COUNT(*) FROM MEMBERS WHERE EMAIL=#{email}
    </select>
    <select id="insertUser" parameterType="com.project.model.UserDto" resultType="int">
        INSERT MEMBERS 
        (USER_ID, PASSWD, USER_NAME, EMAIL, TEL, AGE, LANG_TPCD, DATE_TPCD, VIEW_ADULT, SAVE_HISTORY, TERMS, USER_TPCD)
        VALUES
        (#{userId}, #{passwd}, #{userName}, #{email}, #{tel}, #{age}, #{signupDate}, #{signupDateStr}, #{token}, 
        #{tokenValidity}, #{tokenValidityStr}, #{viewAdult}, #{saveHistory}, #{terms}, #{langTpcd}, #{langTpcdName}, 
        #{dateTpcd}, #{dateTpcdName}, #{userTpcd}, #{userTpcdName})
    </select>
</mapper>